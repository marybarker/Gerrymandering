<! HTML >
<html>
  
  <! HEADER STUFF >
  <head>
    <meta charset="UTF-8" />
    <title> Gerrymandering the Heck out of things </title>
    <style>
      html, body {
        width: 100%;
        height:100%;
        margin: 1px;
        border: 0;
        overflow: hidden; /* no scrollbar */
      }
    </style>
    
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <script id="globalNames">
      var jsonfilename = './NCPrecincts.json';
      var statsFileName = '';
      var shapeFileName = '';
      var centroid = [35.0, -79.9];
      var map;
      var currentDistrict = 0;
      var allColors=[];
      function add_new_color(){
         return '#'+Math.floor(Math.random()*16777215).toString(16);
      }
      allColors[currentDistrict] = add_new_color();

      var districts = [currentDistrict];

      function addAnotherDistrict(){
        currentDistrict = 0;
        if (districts.length > 0){
          currentDistrict = Math.max(districts) + 1;
        }
        districts.push(currentDistrict);
        allColors[currentDistrict] = add_new_color()
      }
    </script>
  </head>
  
  <! BODY>
  <body>
    <div id="amap" style="width:810px; height:420px; position:absolute; margin-left:5px; margin-top:5px"></div>
    
    <div id='summary-stats' style='margin-left:820px; margin-right:5px; border:2px; border-color:gray; color:gray'>
     <button onclick="addAnotherDistrict()">generate new districts </button> 
      <ul>
        <li>Number of districts: 0</li>
        <li>Current District: NA
          <ul>
             <li id="listContiguousness"> Contiguousness</li>
             <li id="listCompactness"> Compactness</li>
             <li id="listUnassigned"> Unnassigned</li>
          </ul>
        </li>
      </ul>
    </div>

    <! Functions for building and interacting with map>
    <script> 
      function myMap(){
        
        map = new google.maps.Map(document.getElementById("amap"), {
          zoom:7, 
          center: new google.maps.LatLng(centroid[0],centroid[1]) 
        });
        
        map.data.loadGeoJson(jsonfilename);
        
        map.data.forEach(function(feature){
          feature.setProperty('District', 'notAssigned');
        });
        
        map.data.setStyle(function(feature){
          var  myColor = '#000000';
          
          if (feature.getProperty('District') == 'notAssigned'){
            myColor="#FFFAFA";
          }
          if ( districts.includes(feature.getProperty('District')) ) {
            myColor = allColors[feature.getProperty('District')];
          }

          return ({
            fillColor: myColor, 
            strokeWeight: .1
          });
        });
        
        map.data.addListener('click', function(event){
          event.feature.setProperty("District", currentDistrict);
        });
        
        map.data.addListener('mouseover', function(event){
          map.data.revertStyle();
          map.data.overrideStyle(event.feature, {strokeWeight:2});
        });
        
        map.data.addListener('mouseout', function(event){
          map.data.revertStyle();
        });
      }
    </script>

    <! Now create map to look at>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBmcXDZ1Pv-BImJhZceCVTmDSjXUCgzN80&callback=myMap">
    </script>
    
  </body>
</html>
